---
name: orchestrate
description: 開発フローのオーケストレーション。各フェーズ（要件定義、設計、実装、テスト、ドキュメント）の管理と、適切なエージェント（サブエージェント、Codex、Gemini）の呼び出しを行う。トリガー: "orchestrate", "フェーズ開始", "次のフェーズ", "/orchestrate"
---

# Orchestration Skill

開発プロジェクトの各フェーズを管理し、適切なエージェントを呼び出すオーケストレーションスキル。

## 概要

このスキルは、Claude Code（主エージェント）がオーケストレーターとして機能し、開発の各フェーズで適切なサブエージェントや外部エージェント（Codex、Gemini）を呼び出すためのガイドラインを提供します。

## エージェント構成

### 主エージェント: Claude Code（オーケストレーター）
- プロジェクト全体の進行管理
- タスクの分配と調整
- フェーズ間の移行判断

### サブエージェント（Claude Code内蔵）
- **Plan Agent**: 実装計画の立案
- **Implementation Agent**: コード実装
- **Test Agent**: テスト実行
- **Refactor Agent**: リファクタリング

### 外部エージェント（Skills経由）
- **Codex** (`/codex-review`): 各フェーズのレビュー
- **Gemini** (`/gemini-docs`): ドキュメント生成

## フェーズ別ワークフロー

### Phase 1: 要件定義

#### 1.1 要件のヒアリング
```
[Claude Code] ユーザーから要件をヒアリング
```

#### 1.2 要件の整理
```
[Claude Code] CLAUDE.mdに要件を記載
- 機能要件
- 非機能要件
- ユーザーストーリー
- 優先度
```

#### 1.3 Codexレビュー
```bash
/codex-review
# 要件定義の妥当性、完全性、実現可能性を確認
```

#### 1.4 要件の確定
```
[Claude Code] レビューフィードバックを反映し、要件を確定
```

**チェックポイント**:
- [ ] 機能要件が明確に定義されている
- [ ] 非機能要件（性能、セキュリティなど）が定義されている
- [ ] ユーザーストーリーが具体的
- [ ] Codexレビュー完了

---

### Phase 2: 設計

#### 2.1 設計の立案
```
[Plan Agent] アーキテクチャ、データモデル、API設計の立案
使用: EnterPlanMode or /plan skill
```

#### 2.2 設計ドキュメントの作成
```
[Claude Code] 設計内容をCLAUDE.mdまたは別ファイルに記載
- システムアーキテクチャ
- データモデル（ER図など）
- API設計
- UI/UX設計
```

#### 2.3 Codexレビュー
```bash
/codex-review
# 設計の妥当性、整合性、スケーラビリティを確認
```

#### 2.4 設計の確定
```
[Claude Code] レビューフィードバックを反映し、設計を確定
```

**チェックポイント**:
- [ ] アーキテクチャが明確
- [ ] データモデルが正規化されている
- [ ] API設計が一貫している
- [ ] Codexレビュー完了

---

### Phase 3: 実装

#### 3.1 実装計画の作成
```
[Plan Agent] 実装タスクの分解と優先順位付け
使用: TaskCreate for task tracking
```

#### 3.2 実装の実行
```
[Implementation Agent] コードの実装
- バックエンド実装
- フロントエンド実装
- データベース構築
- 統合
```

#### 3.3 コードレビュー（段階的）
```bash
# 主要機能実装後に実行
/codex-review
# コード品質、ベストプラクティス、セキュリティを確認
```

#### 3.4 実装の完了
```
[Claude Code] すべての機能が実装されたことを確認
```

**チェックポイント**:
- [ ] すべての機能が実装されている
- [ ] コーディング規約に準拠している
- [ ] セキュリティ脆弱性がない
- [ ] Codexレビュー完了

---

### Phase 4: テスト

#### 4.1 テスト計画の作成
```
[Test Agent] テスト戦略とテストケースの設計
使用: /tdd skill for TDD approach
```

#### 4.2 テストコードの作成
```
[Test Agent] テストコードの実装
- ユニットテスト
- 統合テスト
- E2Eテスト
使用: /e2e skill for E2E tests
```

#### 4.3 テストの実行
```
[Test Agent] テストの実行とカバレッジ確認
```

#### 4.4 Codexレビュー
```bash
/codex-review
# テストカバレッジ、テストケースの妥当性を確認
```

#### 4.5 テストの完了
```
[Claude Code] すべてのテストがパスしたことを確認
```

**チェックポイント**:
- [ ] ユニットテストのカバレッジ80%以上
- [ ] 統合テストが完了
- [ ] E2Eテストが完了
- [ ] すべてのテストがパス
- [ ] Codexレビュー完了

---

### Phase 5: ドキュメント作成

#### 5.1 ドキュメント生成
```bash
# README生成
/gemini-docs
# タイプ: README

# API仕様書生成
/gemini-docs
# タイプ: API仕様書

# ユーザーマニュアル生成
/gemini-docs
# タイプ: ユーザーマニュアル
```

#### 5.2 ドキュメントレビュー
```bash
/codex-review
# ドキュメントの完全性、正確性、可読性を確認
```

#### 5.3 ドキュメントの修正
```
[Claude Code] レビューフィードバックを反映
```

#### 5.4 ドキュメントの確定
```
[Claude Code] すべてのドキュメントが完成したことを確認
```

**チェックポイント**:
- [ ] README.mdが完成
- [ ] API仕様書が完成
- [ ] ユーザーマニュアルが完成
- [ ] Codexレビュー完了

---

### Phase 6: デプロイ・リリース

#### 6.1 デプロイ準備
```
[Claude Code] デプロイ環境の準備
- CI/CD設定
- 環境変数の設定
- ドメイン設定
```

#### 6.2 デプロイの実行
```
[Claude Code] 本番環境へのデプロイ
```

#### 6.3 動作確認
```
[Test Agent] 本番環境での動作確認
```

#### 6.4 リリースノート作成
```bash
/gemini-docs
# タイプ: リリースノート
```

**チェックポイント**:
- [ ] デプロイ成功
- [ ] 本番環境で正常動作
- [ ] リリースノート作成

---

## フェーズ移行のトリガー

各フェーズは以下の条件を満たした場合に次フェーズへ移行：

1. **要件定義 → 設計**: Codexレビュー承認 + ユーザー確認
2. **設計 → 実装**: Codexレビュー承認 + ユーザー確認
3. **実装 → テスト**: 全機能実装完了 + Codexレビュー承認
4. **テスト → ドキュメント**: 全テストパス + Codexレビュー承認
5. **ドキュメント → デプロイ**: 全ドキュメント完成 + Codexレビュー承認
6. **デプロイ → リリース**: デプロイ成功 + 動作確認完了

## エージェント呼び出しルール

### サブエージェント（自動呼び出し）
```
[Plan] EnterPlanMode / /plan
[Implementation] 直接実装
[Test] /tdd, /e2e
[Refactor] 直接リファクタリング
```

### 外部エージェント（Skill経由）
```
[Codex] /codex-review
[Gemini] /gemini-docs
```

## CLAUDE.mdの更新

各フェーズ完了時にCLAUDE.mdを更新：
- チェックボックスにチェック
- 現在のフェーズを更新
- 次のアクションを記載

## 並行作業の考慮

以下の作業は並行実行可能：
- 実装とテストコード作成（TDD）
- ドキュメント作成とコードレビュー

## エラーハンドリング

### レビュー不合格時
```
1. Codexのフィードバックを確認
2. 該当フェーズに戻る
3. 修正を実施
4. 再度Codexレビューを実行
```

### テスト失敗時
```
1. 失敗したテストを確認
2. 実装を修正
3. テストを再実行
4. 必要に応じてCodexレビューを実行
```

## ベストプラクティス

1. **早期レビュー**: 各フェーズの早い段階でCodexレビューを実行し、大きな手戻りを防ぐ
2. **段階的実装**: 大きな機能は小さく分割して実装し、段階的にレビューを行う
3. **TDD推奨**: テスト駆動開発でテストと実装を並行して進める
4. **ドキュメント同期**: コード変更時にドキュメントも同時に更新する
5. **継続的レビュー**: フェーズ完了時だけでなく、適宜Codexレビューを実行する

## 使用例

### プロジェクト開始時
```
1. ユーザーから要件をヒアリング
2. CLAUDE.mdに要件を記載
3. /codex-review で要件レビュー
4. /plan で設計計画を立案
5. /codex-review で設計レビュー
6. 実装開始
```

### 実装中
```
1. 機能ごとに実装
2. /tdd でテスト駆動開発
3. 主要機能完了後 /codex-review
4. フィードバックを反映
5. 次の機能へ
```

### リリース前
```
1. /e2e でE2Eテスト実行
2. /gemini-docs でドキュメント生成
3. /codex-review でドキュメントレビュー
4. デプロイ準備
5. リリース
```

## 注意事項

- 各フェーズのチェックポイントを必ず確認すること
- Codexレビューは読み取り専用で実行されるため、修正は別途実施すること
- ドキュメントは実装と同期を保つこと
- フェーズ移行時はユーザー確認を取ること
